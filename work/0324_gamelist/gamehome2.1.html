<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <meta name="format-detection" content="telephone=no" />
        <title>开张大吉 豆游大厅</title>
        <script src="https://h5.tudouni.doubozhibo.com/tudouni/js/whyInvistor.js"></script>
        <script src="https://h5.tudouni.doubozhibo.com/tudouni/js/jquery.js"></script>
        <script src="https://h5.tudouni.doubozhibo.com/tudouni/js/vue.min.js"></script>
        <style>
            * {margin: 0; padding: 0; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);-webkit-tap-highlight-color: transparent;tap-highlight-color: rgba(0, 0, 0, 0);}
            body {-moz-user-select: none; -webkit-user-select: none; -ms-user-select: none; -khtml-user-select: none; user-select: none; }
            img {width: 100%; display: block;}
            .top, .content, .bottom {position: relative;}
            .douniu {position: absolute; bottom: 7%; width: 33%; left: 14%; top: 60%;}
            .doudizhu {position: absolute; bottom: 7%; width: 33%; left: 52%; top: 60%;}
            .bottom a {position: absolute; bottom: 0; right: 36%; width: 18%; height: 30px;}
            .kmask{width: 100%;height: 100%;position: fixed;top: 0;right: 0;background:rgba(0, 0, 0, 0.7);z-index: 99;overflow: hidden;}
            .kmask_box{width: 100%;position: fixed;top: 35%;z-index: 100;}
            .kmask_box img{width: 80%;margin: 0 auto;}
            .kmask_box p{position: absolute;bottom: 42%;padding: 0 22%;text-indent: 2em;font-size: 12px;color: #fdf277;}
            .kmask_box div{width: 30%;height: 32px;position: absolute;bottom: 11%;left: 32%;color: transparent;}

            /* 排行榜样式 */
            .content_list {position: absolute; top: 8%; bottom: 6%; left: 7%; right: 8%;}
            .content_list ul {list-style: none; width: 100%; height: 100%; display: table; overflow: hidden;}
            .content_list li {overflow: hidden; display: table-row; vertical-align: middle;}
            .list_toux, .list_text {display: inline-block; vertical-align: middle;}
            .list_toux {width: 2.3rem; height: 2.3rem; margin-left: 2rem; position: relative; border-radius: 100%; border: 2px solid #1c7f02;}
            .list_toux img {border-radius: 100%; width: 100%; height: 100%; position: relative; z-index: 99;}
            .list_toux span {
                position: absolute; display: inline-block; width: 1.8rem; height: 1.5rem; left: -2rem; top: 21%;
                background: url(https://image.tudouni.doubozhibo.com/common/h5/carnival/0321yx_other.png) no-repeat;
                background-size: 100%;
            }
            .list_toux.list_glod span{
                background: url(https://image.tudouni.doubozhibo.com/common/h5/carnival/0321yx_glod.png) no-repeat;
                background-size: 100%;
            }
            .list_toux.list_silver span{
                background: url(https://image.tudouni.doubozhibo.com/common/h5/carnival/0321yx_silver.png) no-repeat;
                background-size: 100%;
            }
            .list_toux.list_cuprum span{
                background: url(https://image.tudouni.doubozhibo.com/common/h5/carnival/0321yx_cuprum.png) no-repeat;
                background-size: 100%;
            }
            .list_glod {border: 2px solid #996c33;}
            .list_silver {border: 2px solid #aaaaaa;}
            .list_cuprum {border: 2px solid #b2666a;}
            .list_toux.list_ten span {
                width: 1.2rem; height: 1.2rem; line-height: 1.1rem; left: -1.7rem; color: #fff; font-size: 0.6rem; text-align: center; vertical-align: middle;
                font-weight: 600;
            }
            .list_text {width: 67%; background: #fcf29c; color: #fea01f;  border-radius: 25px; margin-left: 0.2rem; padding: 0 0.2rem;}
            .list_text p {
                display: inline-block; font-size: 0.6rem; width: 47%; height: 1rem; line-height: 1rem; vertical-align: middle; 
                text-overflow: ellipsis; white-space: nowrap; overflow: hidden; font-weight: bold;
            }
            .list_text :nth-child(1) {width: 51%;}
            .list_text :nth-child(2) {width: 44%;}
            .list_text p span:nth-child(1) {color: #086b3e;}
            .list_text p span:nth-child(2) {font-weight: 500;}
            .list_text p .num {color: #ff8b00; font-weight: 600;}
            /* 我的排行 */
            .my_list_wrap {position: absolute; bottom: 0.2%; top: 96%; left: 7%; right: 8%;}
            .my_list_table {width: 100%; height: 100%; display: table;}
            .my_list_row {display: table-row; vertical-align: middle;}
            .my_list_row .no_list {
                position: absolute; display: inline-block; width: 1.8rem; left: -2.4rem; top: 28%; font-size: 0.5rem; font-weight: bold; 
                color: #fff; border-radius: 15px 5px 5px 15px; background: #086b3e; border: 2px solid #319869; z-index: 1; padding: 2px 0 2px 5px;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="top">
                <img src="https://image.tudouni.doubozhibo.com/common/h5/carnival/0321yx_01.jpg">
                <div class="douniu" @click="goGames(1)"></div>
                <div class="doudizhu" @click="goGames(2)"></div>
            </div>
            <div class="content">
                <img src="https://image.tudouni.doubozhibo.com/common/h5/carnival/0321yx_02.jpg" alt="">
                <!-- 排行榜 -->
                <div class="content_list">
                    <ul>
                        <li v-if="item.length > 1">
                            <div class="list_toux list_glod">
                                <img :src="item[0].avatar ? item[0].avatar : 'https://h5.tudouni.doubozhibo.com/m/img/userHeader.png'" alt="">
                                <span></span>
                            </div>
                            <div class="list_text">
                                <p><span>昵称：</span><span v-text="item[0].nickname"></span></p>
                                <p><span>战豆力：</span><em class="num">{{item[0].ratio | fighting}}</em></p>
                            </div>
                        </li>
                        <li v-if="item.length > 2">
                            <div class="list_toux list_silver">
                                <img :src="item[1].avatar ? item[1].avatar : 'https://h5.tudouni.doubozhibo.com/m/img/userHeader.png'" alt="">
                                <span></span>
                            </div>
                            <div class="list_text">
                                <p><span>昵称：</span><span v-text="item[1].nickname"></span></p>
                                <p><span>战豆力：</span><em class="num">{{item[1].ratio | fighting}}</em></p>
                            </div>
                        </li>
                        <li v-if="item.length > 3">
                            <div class="list_toux list_cuprum">
                                <img :src="item[2].avatar ? item[2].avatar : 'https://h5.tudouni.doubozhibo.com/m/img/userHeader.png'" alt="">
                                <span></span>
                            </div>
                            <div class="list_text">
                                <p><span>昵称：</span><span v-text="item[2].nickname"></span></p>
                                <p><span>战豆力：</span><em class="num">{{item[2].ratio | fighting}}</em></p>
                            </div>
                        </li>
                        <li v-for="(i, index) in item" v-if="index > 2">
                            <div class="list_toux list_ten">
                                <img :src="i.avatar ? i.avatar : 'https://h5.tudouni.doubozhibo.com/m/img/userHeader.png'" alt="">
                                <span v-text="index + 1"></span>
                            </div>
                            <div class="list_text">
                                <p><span>昵称：</span><span v-text="i.nickname"></span></p>
                                <p><span>战豆力：</span><em class="num">{{i.ratio | fighting }}</em></p>
                            </div>
                        </li>
                    </ul>
                </div>
                <!-- 我的排名 -->
                <div class="my_list_wrap" v-if='melist'>
                    <div class="my_list_table">
                        <div class="my_list_row">
                            <div class="list_toux list_ten">
                                <img :src='medata.avatar ?  medata.avatar : "https://h5.tudouni.doubozhibo.com/m/img/userHeader.png"' alt="">
                                <span v-text="ranking" v-show="inRanking"></span>
                                <p class="no_list" v-show="!inRanking">未上榜</p>
                            </div>
                            <div class="list_text">
                                <p><span>昵称：</span><span v-text="medata.nickname"></span></p>
                                <p><span>战豆力：</span><em class="num">{{medata.ratio | fighting }}</em></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bottom">
                <img src="https://image.tudouni.doubozhibo.com/common/h5/carnival/0321yx_03.jpg" alt="">
                <a href="https://static.meiqia.com/dist/standalone.html?_=t&eid=59437"></a>
            </div>

            <!-- 人数限制提示 -->
            <div class="kmask" v-if="kmask">
                <div class="kmask_box">
                    <img src="http://image.tudouni.doubozhibo.com/common/h5/carnival/0320_2.png" alt="">
                    <p class="tip" v-text="tips"></p>
                    <div class="confirm" @click="hideMask(false)">确认</div>
                </div>
            </div>
        </div>
    </body>
        <script>
            new Vue({
                el: '.container',
                data: {
                    kmask: false,
                    str: '',
                    AccessToken: '',
                    appVersion: '',
                    IsLive: '',
                    tips: '',
                    listdata: [],
                    item: [],
                    melist: false,//我的排名
                    inRanking: false,
                    ranking: '',
                    medata: {}
                },
                mounted: function() {
                    this.IsLive = this.kgetCookie("IsLive");
                    this.appVersion = this.kgetCookie("appVersion");
                    this.AccessToken = this.kgetCookie("AccessToken");

                    var obj = {};
                        obj.IsLive = this.IsLive;
                        obj.appVersion = this.appVersion;
                        obj.AccessToken = this.AccessToken;
                    this.str = this.stringfyQueryString(obj);
                    this.getList();
                    this.getMeinfo();
                },
                methods: {
                    hideMask: function(x, tips) {
                        this.kmask = x;
                        this.tips = tips; 
                    },
                    goGames: function(x) {
                        var self = this;
                        if (!self.AccessToken) {
                            self.hideMask(true, '温馨提示：您的版本过低哦');
                            return;
                        }
                        switch (x) {
                            case 1:
                                $.ajax({
                                    type: "get",
                                    url: 'https://wap.tudouni.doubozhibo.com/auth/games/h5/isSetBoundless',
                                    data: {
                                        partyId: '5aa53a898e9d080b6d84d8f1'
                                    },
                                    success: function(res){
                                        if (res.data) {
                                            window.location.href = "http://www.20m3.cn/h5/tudouni?" + self.str;
                                        } else {
                                            self.hideMask(true, '当前用户过多 ，为保证测试期间体验更为流畅， 请您稍后再试');
                                        }
                                    }
                                });
                                break;
                            case 2:
                                $.ajax({
                                    type: "get",
                                    url: 'https://wap.tudouni.doubozhibo.com/auth/games/h5/isSetBoundless',
                                    data: {
                                        partyId: '5aa5454f8e9d080b6d84d948'
                                    },
                                    success: function(res){
                                        if (res.data) {
                                            window.location.href = "http://tdn.biekeng.com/Application/Home/View/default/Index/index.html?" + self.str;
                                        } else {
                                            self.hideMask(true, '当前用户过多 ，为保证测试期间体验更为流畅， 请您稍后再试');
                                        }
                                    }
                                });
                                break;
                            default:
                                return;
                        }
                    },
                    getList: function() {
                        var self = this;
                        $.ajax({
                            type: "get",
                            // url: 'https://waptest.tudouni.doubozhibo.com/auth/games/h5/gameList',
                            url: '../data/gamelist.json',
                            data: {
                                type: 'monthly',
                                count: 100
                            },
                            success: function(res){
                                if (res.code == 0 && res.data) {
                                    self.listdata = res.data;
                                    self.item = res.data.slice(0, 20);
                                }
                            }
                        });
                    },
                    getMeinfo: function() {
                        var self = this;
                        $.ajax({
                            type: "get",
                            // url: 'https://waptest.tudouni.doubozhibo.com/auth/games/h5/myList',
                            url: '../data/me.json',
                            data: {
                                type: 'daily',
                                //gh5Token: self.AccessToken
                                gh5Token: '88fdf90dbd5adb9f44f790eeb7d14d6b'
                            },
                            // beforeSend: function(xhr){
                            //     // xhr.setRequestHeader('gh5Sign', self.AccessToken);
                            //     // xhr.setRequestHeader('gh5Token', '47ca130e4e210046b3b5048291bc9297');
                            //     // xhr.setRequestHeader('gh5Token', self.AccessToken);
                            // },
                            success: function(res){
                                if (res.code == 0) {
                                    self.melist = true;
                                    self.medata = res.data[0];
                                    self.changeMe(self.medata);
                                }
                            },
                            error: function(res) {
                                console.log(res);
                            }
                        });
                    },
                    changeMe: function(data) {
                        var self = this;
                        for (var i=0; i<self.listdata.length; i++) {
                            if (data.ratio >= self.listdata[i].ratio) {
                                self.inRanking = true;
                                self.ranking = i + 1;
                                return;
                            }
                        } 
                    },
                    stringfyQueryString: function(obj) {
                        if (!obj) return '';
                        var pairs = [];
                        for (var key in obj) {
                            var value = obj[key];
                            if (value instanceof Array) {
                                for (var i = 0; i < value.length; ++i) {
                                    pairs.push(encodeURIComponent(key + '[' + i + ']') + '=' + encodeURIComponent(value[i]));
                                }
                                continue;
                            }
                            pairs.push(encodeURIComponent(key) + '=' + encodeURIComponent(obj[key]));
                        }
                        return pairs.join('&');
                    },
                    kgetCookie: function(name) {
                        if(document.cookie.length > 0){
                            k_start = document.cookie.indexOf(name + "=");
                            if(k_start != -1){
                                k_start = k_start + name.length + 1;
                                k_end = document.cookie.indexOf(";",k_start);
                                if(k_end == -1){k_end = document.cookie.length}
                                return unescape(document.cookie.substring(k_start,k_end));
                            }
                        }
                        return "";
                    },
                    parseQueryString: function(url) {
                        url = url == null ? window.location.href : url
                        if(url.indexOf('?') > -1){
                            var search = url.substring(url.lastIndexOf('?') + 1)
                            if (!search) {
                                return {}
                            }
                            return JSON.parse('{"' + decodeURIComponent(search).replace(/"/g, '\\"').replace(/&/g, '","').replace(/=/g, '":"') + '"}')
                        }else{
                            return {}
                        }
                    }
                },
                filters: {
                    fighting : function(value) {
                        if (value == 0) return 0;
                        value = value * 1000 - 1000;
                        return parseInt(value);
                    }
                }
            })
        </script>
</html>